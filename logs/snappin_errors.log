{"timestamp": "2025-06-10T17:21:33.257492", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-10T17:21:33.320403", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-10T17:21:33.356603", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-10T17:21:33.368287", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:28.169059", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:28.180168", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:28.199487", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:28.286789", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:29.388891", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:29.394636", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:29.407911", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:29.413710", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:32.834989", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:32.871898", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:32.895739", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:32.907301", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:54.274096", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:54.284456", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:54.326592", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:54.363602", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:57.664241", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:57.680059", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:57.704911", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:26:57.711526", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:27:22.203054", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:27:22.209568", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:27:22.231299", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate organization overview", "operation": "organization_overview", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:27:22.244449", "level": "ERROR", "logger": "app.api.routes.analytics", "message": "Organization overview request failed - system error", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "organization_overview_request", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/analytics.py\", line 53, in get_organization_overview\n    overview_data = AnalyticsService.get_organization_overview(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/cache_service.py\", line 259, in wrapper\n    result = f(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 123, in get_organization_overview\n    total_photos = photos_in_events.count()\n                   ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 3112, in count\n    self._legacy_from_self(col).enable_eagerloads(False).scalar()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2805, in scalar\n    ret = self.one()\n          ^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2778, in one\n    return self._iter().one()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4828, in visit_select\n    text = self._compose_select_body(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4977, in _compose_select_body\n    f._compiler_dispatch(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4271, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4314, in visit_subquery\n    return self.visit_alias(subquery, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4243, in visit_alias\n    inner = alias.element._compiler_dispatch(\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T00:29:46.520561", "level": "ERROR", "logger": "app.services.analytics_service", "message": "Failed to generate daily activity trends", "operation": "daily_activity_trends", "error": "Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly.", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/services/analytics_service.py\", line 595, in _get_daily_activity\n    .all()\n     ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2673, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2306, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py\", line 2191, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1421, in execute\n    return meth(\n           ^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 514, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py\", line 1635, in _execute_clauseelement\n    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(\n                                                ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 702, in _compile_w_cache\n    compiled_sql = self._compiler(\n                   ^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py\", line 315, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 1424, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 865, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 910, in process\n    return obj._compiler_dispatch(self, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/visitors.py\", line 141, in _compiler_dispatch\n    return meth(self, **kw)  # type: ignore  # noqa: E501\n           ^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/compiler.py\", line 4683, in visit_select\n    compile_state = select_stmt._compile_state_factory(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py\", line 684, in create_for_statement\n    return klass.create_for_statement(statement, compiler, **kw)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1162, in create_for_statement\n    self._setup_for_generate()\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1197, in _setup_for_generate\n    self._join(query._setup_joins, self._entities)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1840, in _join\n    self._join_left_to_right(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py\", line 1939, in _join_left_to_right\n    _ORMJoin(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/orm/util.py\", line 1901, in __init__\n    expression.Join.__init__(self, left, right, onclause, isouter, full)\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1213, in __init__\n    self.onclause = self._match_primaries(self.left, self.right)\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1320, in _match_primaries\n    return self._join_condition(left, right, a_subset=left_right)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1343, in _join_condition\n    cls._joincond_trim_constraints(\n  File \"/Users/kaihengzhang/Documents/Snappin/venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py\", line 1488, in _joincond_trim_constraints\n    raise exc.AmbiguousForeignKeysError(\nsqlalchemy.exc.AmbiguousForeignKeysError: Can't determine join between 'photos' and 'events'; tables have more than one foreign key constraint relationship between them. Please specify the 'onclause' of this join explicitly."}
{"timestamp": "2025-06-11T10:14:26.758017", "level": "ERROR", "logger": "app.api.routes.gallery", "message": "Unexpected error getting organization gallery stats", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "get_organization_gallery_stats_error", "error": "name 'Organization' is not defined", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/gallery.py\", line 719, in get_organization_gallery_stats\n    organization = Organization.query.get(user_org_id)\n                   ^^^^^^^^^^^^\nNameError: name 'Organization' is not defined"}
{"timestamp": "2025-06-11T10:14:26.784222", "level": "ERROR", "logger": "app.api.routes.gallery", "message": "Unexpected error getting organization gallery stats", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "get_organization_gallery_stats_error", "error": "name 'Organization' is not defined", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/gallery.py\", line 719, in get_organization_gallery_stats\n    organization = Organization.query.get(user_org_id)\n                   ^^^^^^^^^^^^\nNameError: name 'Organization' is not defined"}
{"timestamp": "2025-06-11T10:16:24.287782", "level": "ERROR", "logger": "app.api.routes.gallery", "message": "Unexpected error getting organization gallery stats", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "get_organization_gallery_stats_error", "error": "name 'Organization' is not defined", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/gallery.py\", line 719, in get_organization_gallery_stats\n    organization = Organization.query.get(user_org_id)\n                   ^^^^^^^^^^^^\nNameError: name 'Organization' is not defined"}
{"timestamp": "2025-06-11T10:16:24.326636", "level": "ERROR", "logger": "app.api.routes.gallery", "message": "Unexpected error getting organization gallery stats", "user_id": "63cf2fbc-4f4e-4e2b-b99e-61bfe031f501", "operation": "get_organization_gallery_stats_error", "error": "name 'Organization' is not defined", "exception": "Traceback (most recent call last):\n  File \"/Users/kaihengzhang/Documents/Snappin/app/api/routes/gallery.py\", line 719, in get_organization_gallery_stats\n    organization = Organization.query.get(user_org_id)\n                   ^^^^^^^^^^^^\nNameError: name 'Organization' is not defined"}
